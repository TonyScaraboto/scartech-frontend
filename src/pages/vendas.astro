---
import { SignedIn, SignedOut } from '@clerk/astro/components';
---

<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vendas - ScarTech Solutions</title>
    <link rel="icon" type="image/png" href="/logo.png" />
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font-family: 'Segoe UI', sans-serif; background: #0a0a0f; color: #e0e0e0; min-height: 100vh; }
      .layout { display: flex; min-height: 100vh; }
      .sidebar { width: 260px; background: linear-gradient(180deg, #0d0d12 0%, #12121a 100%); border-right: 1px solid rgba(0, 255, 255, 0.1); padding: 20px 0; display: flex; flex-direction: column; transition: width 0.3s ease; position: relative; }
      .sidebar.collapsed { width: 70px; }
      .sidebar-header { padding: 0 20px 20px; border-bottom: 1px solid rgba(0, 255, 255, 0.1); display: flex; align-items: center; gap: 12px; }
      .sidebar.collapsed .sidebar-header { justify-content: center; padding: 0 10px 20px; }
      .logo-img { width: 40px; height: 40px; border-radius: 8px; }
      .logo-text { font-size: 1.2rem; font-weight: 700; color: #00ffff; white-space: nowrap; }
      .sidebar.collapsed .logo-text { display: none; }
      .toggle-btn { position: absolute; top: 20px; right: -15px; width: 30px; height: 30px; background: #1a1a2e; border: 1px solid rgba(0, 255, 255, 0.3); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #00ffff; transition: all 0.3s ease; z-index: 10; }
      .toggle-btn:hover { background: rgba(0, 255, 255, 0.2); box-shadow: 0 0 15px rgba(0, 255, 255, 0.4); }
      .hamburger { display: flex; flex-direction: column; gap: 3px; }
      .hamburger span { display: block; width: 14px; height: 2px; background: #00ffff; }
      .nav-section { padding: 20px 0; }
      .nav-title { font-size: 0.7rem; text-transform: uppercase; color: #666; padding: 0 20px; margin-bottom: 10px; letter-spacing: 1px; }
      .sidebar.collapsed .nav-title { display: none; }
      .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: #a0a0a0; text-decoration: none; transition: all 0.3s ease; border-left: 3px solid transparent; }
      .sidebar.collapsed .nav-item { justify-content: center; padding: 12px 10px; }
      .nav-item:hover { background: rgba(0, 255, 255, 0.05); color: #00ffff; border-left-color: #00ffff; box-shadow: inset 0 0 20px rgba(0, 255, 255, 0.1); }
      .nav-item.active { background: rgba(0, 255, 255, 0.1); color: #00ffff; border-left-color: #00ffff; }
      .nav-icon { font-size: 1.2rem; width: 24px; text-align: center; }
      .nav-text { white-space: nowrap; }
      .sidebar.collapsed .nav-text { display: none; }
      .main-content { flex: 1; padding: 30px; overflow-y: auto; }
      .page-header { margin-bottom: 30px; }
      .page-title { font-size: 1.8rem; color: #fff; margin-bottom: 5px; }
      .page-subtitle { color: #666; }
      .card { background: linear-gradient(145deg, #12121a 0%, #1a1a2e 100%); border: 1px solid rgba(0, 255, 255, 0.1); border-radius: 12px; padding: 25px; margin-bottom: 20px; }
      .card-title { font-size: 1.2rem; color: #00ffff; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
      .btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(0, 255, 255, 0.05) 100%); border: 1px solid rgba(0, 255, 255, 0.3); color: #00ffff; text-decoration: none; border-radius: 8px; transition: all 0.3s ease; cursor: pointer; font-size: 1rem; }
      .btn:hover { background: rgba(0, 255, 255, 0.2); box-shadow: 0 0 20px rgba(0, 255, 255, 0.3); transform: translateY(-2px); }
      .btn-primary { background: linear-gradient(135deg, #00ffff 0%, #00cccc 100%); color: #000; border: none; }
      .btn-primary:hover { box-shadow: 0 0 30px rgba(0, 255, 255, 0.5); }
      table { width: 100%; border-collapse: collapse; margin-top: 20px; }
      th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(0, 255, 255, 0.1); }
      th { color: #00ffff; font-weight: 600; }
      tr:hover { background: rgba(0, 255, 255, 0.05); }
      .valor { color: #00ff88; font-weight: 600; }
      .not-signed-in { display: flex; align-items: center; justify-content: center; min-height: 100vh; flex-direction: column; gap: 20px; }
      .login-btn { padding: 12px 30px; background: linear-gradient(135deg, #00ffff 0%, #00cccc 100%); color: #000; text-decoration: none; border-radius: 8px; font-weight: 600; }
      .empty-message { color: #666; text-align: center; padding: 20px; }
      .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 1000; }
      .modal.active { display: flex; }
      .modal-content { background: #12121a; border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 12px; padding: 30px; width: 100%; max-width: 400px; }
      .modal-content h3 { color: #00ffff; margin-bottom: 20px; }
      .form-group { margin-bottom: 15px; }
      .form-group label { display: block; color: #a0a0a0; margin-bottom: 5px; font-size: 0.9rem; }
      .form-group input { width: 100%; padding: 10px 15px; background: rgba(0,0,0,0.3); border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 6px; color: #fff; font-size: 1rem; }
      .form-group input:focus { outline: none; border-color: #00ffff; }
      .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
      .btn-delete { padding: 4px 8px; font-size: 0.8rem; background: rgba(255,100,100,0.2); border-color: rgba(255,100,100,0.3); color: #ff6b6b; }
      .btn-delete:hover { background: rgba(255,100,100,0.3); }
    </style>
  </head>
  <body>
    <SignedOut>
      <div class="not-signed-in">
        <h2>Acesso Restrito</h2>
        <a href="/" class="login-btn">Fazer Login</a>
      </div>
    </SignedOut>

    <SignedIn>
      <div class="layout">
        <aside class="sidebar" id="sidebar">
          <button class="toggle-btn" id="toggleBtn">
            <div class="hamburger"><span></span><span></span><span></span></div>
          </button>
          <div class="sidebar-header">
            <img src="/logo.png" alt="ScarTech" class="logo-img" />
            <span class="logo-text">ScarTech</span>
          </div>
          <nav class="nav-section">
            <div class="nav-title">Principal</div>
            <a href="/dashboard" class="nav-item"><span class="nav-icon">üè†</span><span class="nav-text">Dashboard</span></a>
            <a href="/faturamento" class="nav-item"><span class="nav-icon">üí∞</span><span class="nav-text">Faturamento</span></a>
          </nav>
          <nav class="nav-section">
            <div class="nav-title">Gest√£o</div>
            <a href="/ordens" class="nav-item"><span class="nav-icon">üìã</span><span class="nav-text">Ordens de Servi√ßo</span></a>
            <a href="/produtos" class="nav-item"><span class="nav-icon">üì¶</span><span class="nav-text">Produtos</span></a>
            <a href="/vendas" class="nav-item active"><span class="nav-icon">üõí</span><span class="nav-text">Vendas</span></a>
          </nav>
        </aside>

        <main class="main-content">
          <div class="page-header">
            <h1 class="page-title">Vendas</h1>
            <p class="page-subtitle">Hist√≥rico de vendas realizadas</p>
          </div>

          <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h2 class="card-title" style="margin-bottom: 0;">üõí √öltimas Vendas</h2>
              <button class="btn btn-primary" onclick="abrirModal()">+ Nova Venda</button>
            </div>
            
            <table>
              <thead>
                <tr>
                  <th>N¬∫</th>
                  <th>Cliente</th>
                  <th>Produto</th>
                  <th>Valor</th>
                  <th>Data</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="vendasBody">
                <tr><td colspan="6" class="empty-message">Nenhuma venda registrada</td></tr>
              </tbody>
            </table>

            <!-- Modal Nova Venda -->
            <div class="modal" id="modalVenda">
              <div class="modal-content">
                <h3>Nova Venda</h3>
                <form id="formVenda">
                  <div class="form-group">
                    <label>Cliente</label>
                    <input type="text" id="clienteVenda" required />
                  </div>
                  <div class="form-group">
                    <label>Produto</label>
                    <input type="text" id="produtoVenda" required />
                  </div>
                  <div class="form-group">
                    <label>Valor (R$)</label>
                    <input type="number" id="valorVenda" step="0.01" required />
                  </div>
                  <div class="modal-actions">
                    <button type="button" class="btn" onclick="fecharModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                  </div>
                </form>
              </div>
            </div>

            <a href="/dashboard" class="btn" style="margin-top: 20px;">‚Üê Voltar</a>
          </div>
        </main>
      </div>
    </SignedIn>

    <script>
      document.getElementById('toggleBtn')?.addEventListener('click', () => {
        document.getElementById('sidebar')?.classList.toggle('collapsed');
      });

      let vendas = JSON.parse(localStorage.getItem('scartech_vendas') || '[]');
      
      function renderVendas() {
        const tbody = document.getElementById('vendasBody');
        if (vendas.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="empty-message">Nenhuma venda registrada</td></tr>';
        } else {
          tbody.innerHTML = vendas.map((v, i) => `
            <tr>
              <td>#V${String(i + 1).padStart(3, '0')}</td>
              <td>${v.cliente}</td>
              <td>${v.produto}</td>
              <td class="valor">R$ ${v.valor.toFixed(2)}</td>
              <td>${v.data}</td>
              <td><button class="btn btn-delete" onclick="excluirVenda(${i})">üóëÔ∏è</button></td>
            </tr>
          `).join('');
        }
      }

      function abrirModal() {
        document.getElementById('modalVenda').classList.add('active');
      }

      function fecharModal() {
        document.getElementById('modalVenda').classList.remove('active');
        document.getElementById('formVenda').reset();
      }

      function excluirVenda(index) {
        if (confirm('Excluir esta venda?')) {
          vendas.splice(index, 1);
          localStorage.setItem('scartech_vendas', JSON.stringify(vendas));
          renderVendas();
        }
      }

      document.getElementById('formVenda')?.addEventListener('submit', (e) => {
        e.preventDefault();
        const venda = {
          cliente: document.getElementById('clienteVenda').value,
          produto: document.getElementById('produtoVenda').value,
          valor: parseFloat(document.getElementById('valorVenda').value),
          data: new Date().toLocaleDateString('pt-BR')
        };
        vendas.push(venda);
        localStorage.setItem('scartech_vendas', JSON.stringify(vendas));
        fecharModal();
        renderVendas();
      });

      renderVendas();
    </script>
  </body>
</html>
